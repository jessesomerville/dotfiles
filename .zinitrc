#!/usr/bin/env zsh

local zinitdir="$XDG_DATA_HOME/zinit"
if [[ ! -f "$zinitdir/zinit.git/zinit.zsh" ]]; then
  echoinfo "Installing zinit..."
  mkdir -pm 705 $zinitdir
  git clone https://github.com/zdharma-continuum/zinit "$zinitdir/zinit.git" \
    && echoinfo "Installation successful" \
    || echoerr "Installation failed" 
fi

source "$zinitdir/zinit.git/zinit.zsh"
autoload -Uz _zinit
(( ${+_comps} )) && _comps[zinit]=_zinit

ZSH_AUTOSUGGEST_MANUAL_REBIND=1 # Manually load autosuggest widgets

typeset -U zle_highlight
zle_highlight=(paste:none $zle_highlight)  # don't highlight when pasting

zi wait lucid light-mode for \
  atload'FAST_HIGHLIGHT[chroma-man]=' \
  atclone'(){local f;cd -q â†’*;for f (*~*.zwc){zcompile -Uz -- ${f}};}' \
  compile'.*fast*~*.zwc' nocompletions atpull'%atclone' \
    zdharma-continuum/fast-syntax-highlighting \
  atload'_zsh_autosuggest_start' \
    zsh-users/zsh-autosuggestions


zi ice depth'1' as"command" from"gh-r" \
  atclone"./starship init zsh > init.zsh" \
  atpull"%atclone" src"init.zsh"
zi light starship/starship

zicompinit_fast
zinit cdreplay -q
